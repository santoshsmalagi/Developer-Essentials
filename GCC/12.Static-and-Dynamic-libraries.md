# 12. Static and Dynamic libraries

## Linking with external libraries

Refer Section 2.6

## Link order of libraries

Refer Section 2.7

## Library header files

## Examining object files and binaries

The following table summarizes several useful tools for working with and examining the contents of object files and binaries:

| Utilities                              | Purpose                                                                                |
|----------------------------------------|----------------------------------------------------------------------------------------|
| ``strace`` (Linux command line utility)    | print a list of low-level (kernel) system calls made when the  binary is executed      |
| ``ltrace`` (Linux command line utility)    | print a list of calls made to the library functions when the binary is executed        |
| ``file``  (Linux command line utility)     | to find the most basic details about the generated binary                              |
| ``size`` (part of GNU Binutils)            | list the sizes of various sections (i.e. text, data, bss) within a binary              |
| ``nm`` (part of GNU Binutils)              | primarily to examine the symbol table and check whether a function/variable is defined |
| ``ldd`` (Linux utility, actually a script) | examine the shared lib dependencies                                                    |
| ``objdump`` (part of GNU Binutils)         | display information about object files                                                 |
| ``readelf`` (part of GNU Binutils)         | display information about an ELF file                                                  |
| ``strip`` (part of GNU Binutils)           | discards symbols               |
| ``addr2line`` (Linux command line utility)   | trace the line number in src code using a debug build                                  |
| ``gdb`` (Linux utility)                                    | The classic C/C++ source level debugger on Linux systems                               |


The usage of these utilities will be illustrated using the classic *Hello-World!* program written using multiple source files as follows: 

```helloWorld.h``` declares the function prototype for ```hello```.

```C
/**********************************************
helloWorld.h
***********************************************/

#ifndef HELLO_WORLD
#define HELLO_WORLD

void hello(const char *str);

#endif
```

```helloWorld.c``` defines the function ```hello```, which simply prints a string to the ```STDOUT```.

```C
/**********************************************
helloWorld.c
***********************************************/

#include <stdio.h>
#include "helloWorld.h"

void hello(const char *str)
{
    printf("%s",str);
}

```

```main.c``` includes ```helloWorld.h``` and calls the function ```hello```.

```C
/**********************************************
main.c
***********************************************/

#include "helloWorld.h"

int main(int argc, char *argv[])
{
    hello("Hello World\n");
    return 0;
}
```

Generate object files (i.e. compile but do not link)

```$ gcc -Wall -c main.c helloWorld.c```

Generate the binary by linking the object files:

```$ gcc -Wall main.o helloWorld.o -o helloWorld```

Now if we run the ``file`` command on the two object files and the binary file generated we might get something as follows:

```Shell
malagi@santoshsmalagi:~/CPrograms$ file helloWorld.o
helloWorld.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped

malagi@santoshsmalagi:~/CPrograms$ file main.o
main.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped

malagi@santoshsmalagi:~/CPrograms$ file helloWorld
helloWorld: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), 
dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, 
BuildID[sha1]=afbf91dbb48bcfe69e6a4c77c66e0889f09729ce, for GNU/Linux 3.2.0, not stripped
```

#### ``strace``
#### ``ltrace``

#### ``file``
The ``file`` command is very handy as it reveals some very basic information about about an object file or binary.
* whether the binary was compiled with dynamic or static linking
* the architecture it was compiled for, e.g. x86-64
* it's internal representation (ELF or COFF) and version (i.e. ``version 1(SYSV)``)
* the word size - 32 bit or 64 bits
* it's *endianness* - little-endian (LSB byte first) or big-endian (MSB byte first)
* whether the symbols are present or stripped.






#### ``size``
#### ``nm``
#### ``ldd``
#### ``objdump``
#### ``readelf``
#### ``strip``
#### ``addr2line``
#### ``gdb``
